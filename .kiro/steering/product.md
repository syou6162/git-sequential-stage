---
inclusion: always
---

# プロダクト概要

git-sequential-stageは、複雑なコード変更から意味のあるコミットを作成する課題を解決するために設計されたGo CLIツールです。特にLLMエージェントとの連携を想定しています。

## 解決する課題
LLMエージェントが複数ファイルにわたって大きな変更を行う際、以下の理由でクリーンでレビュー可能なコミットを作成することが困難です：
- シンプルな`git add -p`ではハンクの依存関係と順序を処理できない
- 複数ファイルの変更から意味的に関連する部分を選択することが困難
- LLMエージェントにはステージングのプログラマティックな制御が必要
- ハンク番号ドリフト問題：早期ハンクの適用により後続ハンクの行番号が変化

## 解決策
このツールは、**パッチID駆動アプローチ**を使用してパッチファイルから指定されたハンクを順次ステージングし、「ハンク番号ドリフト」問題を根本的に解決します：

### 技術的特徴
- **パッチID追跡**: `git patch-id --stable`によるコンテンツベースの一意識別
- **go-gitdiff統合**: 高度なパッチ解析とバイナリファイル対応
- **段階的処理**: 準備フェーズと実行フェーズの分離による信頼性向上
- **構造化エラーハンドリング**: 型付きエラーによる詳細な診断情報

### 実現される機能
- **意味的コミット作成**: 大きな変更を意味のある、焦点を絞ったコミットに分割
- **順次適用**: 依存関係を処理しながら正しい順序でハンクを適用
- **LLMフレンドリーな自動化**: コマンドライン引数によるプログラマティック制御
- **特殊ファイル対応**: バイナリファイル、リネーム、削除の適切な処理

## 主な使用例
- **LLMエージェント統合**: Claude Codeとの連携による自動意味的コミット
- **複雑diff分割**: 大規模変更をレビュー可能なコミットシーケンスに分割
- **精密ステージング制御**: 複数ファイル・複数ハンクの選択的ステージング
- **AI駆動開発ワークフロー**: クリーンなコミット履歴を必要とする自動化

## 主要依存関係
- `git`コマンド（コア機能）
  - `git diff` - パッチ生成
  - `git apply --cached` - ハンクステージング
  - `git patch-id --stable` - パッチID計算
- `github.com/bluekeyes/go-gitdiff` - 高度なパッチ解析
